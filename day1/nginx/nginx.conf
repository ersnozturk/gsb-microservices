# ========================================
# NGINX - API Gateway & Load Balancer
# ========================================

# Backend sunucularımız (5 instance)
upstream backend_servers {
    # Load Balancing Algoritması: Round Robin (varsayılan)
    # Her istek sırayla farklı bir sunucuya gider
    
    server js_container:6000;
    # Docker Compose network sayesinde 
    # "js_container" adıyla tüm instance'lara ulaşılır
}

server {
    listen 80;
    server_name localhost;

    # API Gateway: /js_container ile başlayan istekleri backend'e yönlendir
    location /js_container/ {
        proxy_pass http://backend_servers/;
        
        # İstemci bilgilerini backend'e ilet
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Health check endpoint
    location /health {
        return 200 'Nginx is healthy\n';
        add_header Content-Type text/plain;
    }

    # Ana sayfa bilgilendirme
    location / {
        return 200 '
========================================
  NGINX API Gateway & Load Balancer
========================================
';
        add_header Content-Type text/plain;
    }
}
